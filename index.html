<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />








  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>



  <link href='//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>


<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.1"/>


    <meta name="description" content="acg&programming sharing" />



  <meta name="keywords" content="Hexo,next" />



  <link rel="alternate" href="/atom.xml" title="Winry's" type="application/atom+xml" />



  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.1" />


<meta name="description" content="acg&amp;programming sharing">
<meta property="og:type" content="website">
<meta property="og:title" content="Winry's">
<meta property="og:url" content="https://winry.me/index.html">
<meta property="og:site_name" content="Winry's">
<meta property="og:description" content="acg&amp;programming sharing">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Winry's">
<meta name="twitter:description" content="acg&amp;programming sharing">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post'
  };
</script>

  <script type="text/javascript">
    var host = "winry.me";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
        window.location.protocol = "https";
</script>

  <title> Winry's </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-hk">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-68056846-1', 'auto');
  ga('send', 'pageview');
</script>




  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-next-logo"></i>
      </span>
      <span class="site-title">Winry's</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon icon-next-home"></i> <br />
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            <i class="menu-item-icon icon-next-categories"></i> <br />
            分類
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            <i class="menu-item-icon icon-next-about"></i> <br />
            關於
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            <i class="menu-item-icon icon-next-archives"></i> <br />
            歸檔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            <i class="menu-item-icon icon-next-tags"></i> <br />
            標籤
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 
  <section id="posts" class="posts-expand">
    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/11/30/pattern-matching in java(续)/" itemprop="url">
                pattern-matching in java(续)
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          發表於
          <time itemprop="dateCreated" datetime="2015-11-30T00:00:00+08:00" content="2015-11-30">
            2015-11-30
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分類於
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Programming/" itemprop="url" rel="index">
                  <span itemprop="name">Programming</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/11/30/pattern-matching in java(续)/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/11/30/pattern-matching in java(续)/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>上一篇文章里翻译了java8以前模式匹配在java中的使用情况.<br>这一篇文章会简单介绍cyclops库中模式匹配的相关内容.<br><a href="https://github.com/aol/cyclops" target="_blank" rel="external">cyclops</a>是基于java8的一个扩展库,包括了模式匹配,stream工具类,monad,元组等内容.</p>
<p>直接上完整的代码.handleByType方法匹配类型,handleByValue方法匹配值.<br>isType方法传入一个名为TypedFunction的函数式接口,这个接口里有一个默认方法可以获取lanbda表达式中的泛型具体类型.<br>需要注意的是当需要值匹配时必须重写类的equals方法,因为Object中的equals方法认为两个不同的对象是不相等的.<br><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">package org.gradle.pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.aol.cyclops.matcher.builders.Matching;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Patterns</span> &#123;</span></span><br><span class="line"></span><br><span class="line">	abstract <span class="class"><span class="keyword">class</span> <span class="title">Foo</span> &#123;</span></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Bar</span> <span class="keyword">extends</span> <span class="title">Foo</span> &#123;</span></span><br><span class="line"></span><br><span class="line">		public Bar(Integer bar) &#123;</span><br><span class="line">			<span class="keyword">super</span>();</span><br><span class="line">			<span class="keyword">this</span>.bar = bar;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		private Integer bar;</span><br><span class="line"></span><br><span class="line">		public Integer getBar() &#123;</span><br><span class="line">			<span class="keyword">return</span> bar;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		public <span class="literal">void</span> setBar(Integer bar) &#123;</span><br><span class="line">			<span class="keyword">this</span>.bar = bar;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Baz</span> <span class="keyword">extends</span> <span class="title">Foo</span> &#123;</span></span><br><span class="line"></span><br><span class="line">		public Baz(String baz) &#123;</span><br><span class="line">			<span class="keyword">super</span>();</span><br><span class="line">			<span class="keyword">this</span>.baz = baz;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		private String baz;</span><br><span class="line"></span><br><span class="line">		public String getBaz() &#123;</span><br><span class="line">			<span class="keyword">return</span> baz;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		public <span class="literal">void</span> setBaz(String baz) &#123;</span><br><span class="line">			<span class="keyword">this</span>.baz = baz;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="property">@Override</span></span><br><span class="line">		public int hashCode() &#123;</span><br><span class="line">			final int prime = <span class="number">31</span>;</span><br><span class="line">			int result = <span class="number">1</span>;</span><br><span class="line">			result = prime * result + getOuterType().hashCode();</span><br><span class="line">			result = prime * result + ((baz == <span class="literal">null</span>) ? <span class="number">0</span> : baz.hashCode());</span><br><span class="line">			<span class="keyword">return</span> result;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="property">@Override</span></span><br><span class="line">		public boolean equals(Object obj) &#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="keyword">this</span> == obj)</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">			<span class="keyword">if</span> (obj == <span class="literal">null</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">			<span class="keyword">if</span> (getClass() != obj.getClass())</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">			Baz other = (Baz) obj;</span><br><span class="line">			<span class="keyword">if</span> (!getOuterType().equals(other.getOuterType()))</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">			<span class="keyword">if</span> (baz == <span class="literal">null</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span> (other.baz != <span class="literal">null</span>)</span><br><span class="line">					<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!baz.equals(other.baz))</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		private Patterns getOuterType() &#123;</span><br><span class="line">			<span class="keyword">return</span> Patterns.<span class="keyword">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	Object handleByType(Foo foo) &#123;</span><br><span class="line">		<span class="keyword">return</span> Matching</span><br><span class="line">				.<span class="keyword">when</span><span class="function"><span class="params">()</span>.<span class="title">isType</span><span class="params">((Bar bar) -&gt; bar.getBar())</span></span><br><span class="line">				.<span class="title">when</span><span class="params">()</span>.<span class="title">isType</span><span class="params">((Baz baz) -&gt; baz.getBaz())</span></span><br><span class="line">				.<span class="title">match</span><span class="params">(foo)</span></span><br><span class="line">				.<span class="title">get</span><span class="params">()</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="title">Object</span> <span class="title">handleByValue</span><span class="params">(Foo foo)</span> &#123;</span><br><span class="line">		<span class="title">return</span> <span class="title">Matching</span></span><br><span class="line">				.<span class="title">when</span><span class="params">()</span>.<span class="title">isValue</span><span class="params">(<span class="keyword">new</span> Baz(<span class="string">"Luhrmann"</span>))</span>.<span class="title">thenApply</span><span class="params">(baz -&gt; baz.getBaz())</span></span><br><span class="line">				.<span class="title">match</span><span class="params">(foo)</span></span><br><span class="line">				.<span class="title">orElse</span><span class="params">(<span class="string">"match nothing"</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	@<span class="title">Test</span></span><br><span class="line">	<span class="title">public</span> <span class="title">void</span> <span class="title">test</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(handleByType(<span class="keyword">new</span> Bar(<span class="number">42</span>)))</span>;          // 42</span><br><span class="line">		<span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(handleByType(<span class="keyword">new</span> Baz(<span class="string">"letty"</span>)))</span>;     // <span class="title">letty</span></span><br><span class="line">		<span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(handleByValue(<span class="keyword">new</span> Baz(<span class="string">"Luhrmann"</span>)))</span>; // <span class="title">Luhrmann</span></span><br><span class="line">		<span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span><span class="params">(handleByValue(<span class="keyword">new</span> Baz(<span class="string">""</span>)))</span>;         // <span class="title">match</span> <span class="title">nothing</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>虽然和scala中的guard和case class相比,java中的模式匹配还是不够灵活,<br>然而这毕竟缺少了语言层面的支持.尽管如此,使用cyclops还是比起用访问者模式<br>在可读性和实现的难易度上都大大进步了.<br>预告:下一篇博客可能会继续介绍cyclops,或者是和动静态语言相关的内容.</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/11/04/pattern-matching in java/" itemprop="url">
                pattern-matching in java(翻译)
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          發表於
          <time itemprop="dateCreated" datetime="2015-11-04T00:00:00+08:00" content="2015-11-04">
            2015-11-04
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分類於
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Programming/" itemprop="url" rel="index">
                  <span itemprop="name">Programming</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/11/04/pattern-matching in java/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/11/04/pattern-matching in java/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>模式匹配是一种来源于函数式语言的特性,它有点像java中的switch,<br>然而比switch更加强大,它除了能对值进行匹配之外还能对类型进行匹配.<br>配合scala的模板类,它能写出非常简洁的类型、值匹配的代码.<br>当你需要根据对象的类型或者值的不同来进行不同的逻辑处理时,就应该使用模式匹配.<br>下面的内容将主要针对其中的<strong>类型</strong>匹配展开.</p>
<h3 id="scala中的模式匹配">scala中的模式匹配</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">patterns</span> &#123;</span></span><br><span class="line">  <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span><br><span class="line"></span>  <span class="class"><span class="keyword">class</span> <span class="title">Bar</span>(</span><span class="function"><span class="keyword">val</span> <span class="title">bar</span>:</span> <span class="type">Int</span>) <span class="keyword">extends</span> <span class="type">Foo</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Baz</span>(</span><span class="function"><span class="keyword">val</span> <span class="title">baz</span>:</span> <span class="type">String</span>) <span class="keyword">extends</span> <span class="type">Foo</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">handle</span>(</span>f: <span class="type">Foo</span>) =</span><br><span class="line">    f <span class="keyword">match</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> b: <span class="type">Bar</span> =&gt; b.bar</span><br><span class="line">      <span class="keyword">case</span> b: <span class="type">Baz</span> =&gt; b.baz</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  handle(<span class="keyword">new</span> <span class="type">Bar</span>(<span class="number">42</span>))                       <span class="comment">//&gt; res0: Any = 42</span></span><br><span class="line">  handle(<span class="keyword">new</span> <span class="type">Baz</span>(<span class="string">"Luhrmann"</span>))               <span class="comment">//&gt; res1: Any = Luhrmann</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面定义了一个抽象类Foo和两个子类Bar,Baz(object关键字说明这个类是单例的),<br>两个子类各有一个名称与类型都不同的成员属性,另外有一个handle方法来处理子类对象.<br>scala具有类型推导,所以这里没有声明方法的返回类型.</p>
<h3 id="java中的做法">java中的做法</h3><h4 id="instanceof">instanceof</h4><p>简单的做法是使用instanceof<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BadFoo</span> &#123;</span></span><br><span class="line"></span><br><span class="line">  static <span class="class"><span class="keyword">class</span> <span class="title">Bar</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">BadFoo</span> &#123;</span></span><br><span class="line">    int bar;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Bar</span>(int bar) &#123;</span><br><span class="line">      <span class="keyword">this</span>.bar = bar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  static <span class="class"><span class="keyword">class</span> <span class="title">Baz</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">BadFoo</span> &#123;</span></span><br><span class="line">    <span class="type">String</span> baz;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Baz</span>(<span class="type">String</span> baz) &#123;</span><br><span class="line">      <span class="keyword">this</span>.baz = baz;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  static void handle(<span class="type">BadFoo</span> f) &#123;</span><br><span class="line">    <span class="keyword">if</span> (f instanceof <span class="type">Bar</span>) &#123;</span><br><span class="line">      <span class="type">Bar</span> b = (<span class="type">Bar</span>) f;</span><br><span class="line">      <span class="type">System</span>.out.println(<span class="string">"I have "</span> + b.bar + <span class="string">" bars"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (f instanceof <span class="type">Baz</span>) &#123;</span><br><span class="line">      <span class="type">Baz</span> b = (<span class="type">Baz</span>) f;</span><br><span class="line">      <span class="type">System</span>.out.println(<span class="string">"I have the "</span> + b.baz + <span class="string">" baz"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public static void main(<span class="type">String</span>[] args) &#123;</span><br><span class="line">    handle(<span class="keyword">new</span> <span class="type">Bar</span>(<span class="number">42</span>));</span><br><span class="line">    handle(<span class="keyword">new</span> <span class="type">Baz</span>(<span class="string">"Luhrmann"</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>然而这么写有几个问题,1.在那些使用动态代理的代码中,产生的对象永远不会是原始类的一个实例,<br>instanceof不起作用.2.无法在编译时期进行类型判断,<code>if (f instanceof Bar) Baz b = (Baz) f;</code><br>以上代码能编译通过,但是不能运行.3.当增加了一个新的子类时,不能保证旧代码被及时更新.</p>
<h4 id="Moving_logic_into_the_class">Moving logic into the class</h4><p>另一种做法是把逻辑放到数据对象中,就像OOP应该做的.<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">OoFoo</span> &#123;</span></span><br><span class="line">  <span class="keyword">abstract</span> void handle();</span><br><span class="line"></span><br><span class="line">  static <span class="class"><span class="keyword">class</span> <span class="title">Bar</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">OoFoo</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span> int bar;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Bar</span>(int bar) &#123;</span><br><span class="line">      <span class="keyword">this</span>.bar = bar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    void handle() &#123;</span><br><span class="line">      <span class="type">System</span>.out.println(<span class="string">"I have "</span> + bar + <span class="string">" bars"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  static <span class="class"><span class="keyword">class</span> <span class="title">Baz</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">OoFoo</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> baz;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Baz</span>(<span class="type">String</span> baz) &#123;</span><br><span class="line">      <span class="keyword">this</span>.baz = baz;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    void handle() &#123;</span><br><span class="line">      <span class="type">System</span>.out.println(<span class="string">"I have the "</span> + baz + <span class="string">" baz"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public static void main(<span class="type">String</span>[] args) &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="type">Bar</span>(<span class="number">42</span>).handle();</span><br><span class="line">    <span class="keyword">new</span> <span class="type">Baz</span>(<span class="string">"Luhrmann"</span>).handle();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这么做刚开始还不错,然而当类似的方法逐渐变多,你的数据对象就变成了存放业务逻辑的地方.<br>使用访问者模式能够保持数据对象简单,把业务逻辑放到响应的处理类中.</p>
<h3 id="访问者模式">访问者模式</h3><h4 id="Basic_Visitor">Basic Visitor</h4><p>基本的访问者模式包括以下内容:</p>
<ul>
<li>一个抽象类或者接口包括一个以Visitor作为参数,返回类型为Visitor中泛型类型的方法match</li>
<li>一个Visitor类,包括各个子类对象为参数的case方法</li>
<li>一系列实现了match方法的子类</li>
<li>实现各个case方法的应用代码<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">  <span class="keyword">abstract</span> &lt;T&gt; <span class="function">T <span class="title">match</span><span class="params">(Visitor&lt;T&gt; visitor)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">interface</span> <span class="title">Visitor</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">T <span class="title">caseBar</span><span class="params">(Bar b)</span></span>;</span><br><span class="line">    <span class="function">T <span class="title">caseBaz</span><span class="params">(Baz b)</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Bar</span> <span class="keyword">extends</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> bar;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Bar</span><span class="params">(<span class="keyword">int</span> bar)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.bar = bar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    &lt;T&gt; <span class="function">T <span class="title">match</span><span class="params">(Visitor&lt;T&gt; visitor)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> visitor.caseBar(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Baz</span> <span class="keyword">extends</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> String baz;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Baz</span><span class="params">(String baz)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.baz = baz;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    &lt;T&gt; <span class="function">T <span class="title">match</span><span class="params">(Visitor&lt;T&gt; visitor)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> visitor.caseBaz(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(Foo f)</span> </span>&#123;</span><br><span class="line">    System.out.println(f.match(<span class="keyword">new</span> Visitor&lt;String&gt;() &#123;</span><br><span class="line">      <span class="annotation">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">caseBar</span><span class="params">(Bar b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"I have "</span> + b.bar + <span class="string">" bars"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="annotation">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">caseBaz</span><span class="params">(Baz b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"I have the "</span> + b.baz + <span class="string">" baz"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    handle(<span class="keyword">new</span> Bar(<span class="number">42</span>));</span><br><span class="line">    handle(<span class="keyword">new</span> Baz(<span class="string">"Luhrmann"</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Default_visitor">Default visitor</h4><p>有时候Visitor没必要重写全部的case方法,只重写部分方法,其他时候返回默认值.<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DefaultFooVisitor</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Foo</span>.<span class="title">Visitor</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  T defaultValue;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">DefaultFooVisitor</span><span class="params">(T defaultValue)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.defaultValue = defaultValue;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="function">T <span class="title">caseBar</span><span class="params">(Bar b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> defaultValue;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="annotation">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="function">T <span class="title">caseBaz</span><span class="params">(Baz b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> defaultValue;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="keyword">int</span> <span class="title">countBars</span><span class="params">(Foo f)</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">return</span> f.<span class="title">match</span><span class="params">(<span class="keyword">new</span> DefaultFooVisitor&lt;Integer&gt;(<span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">      <span class="annotation">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="function">Integer <span class="title">caseBar</span><span class="params">(Bar b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b.bar;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>缺点是当增加了新的子类,新增的case方法可能会忘记重写.<br>解决这个问题的一种方法是先把DefaultFooVisitor中新增的case方法改为抽象的,<br>解决了所有的编译问题之后再来实现DefaultFooVisitor中新增的case方法.</p>
<h4 id="Void_or_Unit_return_values">Void or Unit return values</h4><p>有时候返回值是不需要的,可以用<code>Unit.unit</code>或者<code>java.lang.Void</code>来表达空的返回类型.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PartitionFoos</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">doStuff</span><span class="params">(Collection&lt;Foo&gt; foos)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> List&lt;Bar&gt; bars = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">final</span> List&lt;Baz&gt; bazes = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Foo f : foos) &#123;</span><br><span class="line">      f.match(<span class="keyword">new</span> Visitor&lt;Void&gt;() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Void <span class="title">caseBar</span><span class="params">(Bar b)</span> </span>&#123;</span><br><span class="line">          bars.add(b);</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Void <span class="title">caseBaz</span><span class="params">(Baz b)</span> </span>&#123;</span><br><span class="line">          bazes.add(b);</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="解构模式匹配">解构模式匹配</h3><p>前面的例子都只包含了类型匹配,最后的一个例子会展示java处理包含类型以及值匹配的方法.<br>先来看一下scala的代码:<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">patterns</span> &#123;</span></span><br><span class="line">  <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span><br><span class="line"></span>  <span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Bar</span>(</span><span class="function"><span class="keyword">val</span> <span class="title">bar</span>:</span> <span class="type">Int</span>) <span class="keyword">extends</span> <span class="type">Foo</span></span><br><span class="line">  <span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Baz</span>(</span><span class="function"><span class="keyword">val</span> <span class="title">baz</span>:</span> <span class="type">String</span>) <span class="keyword">extends</span> <span class="type">Foo</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">handle</span>(</span>f: <span class="type">Foo</span>) =</span><br><span class="line">    f <span class="keyword">match</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="type">Bar</span>(i) <span class="keyword">if</span> (i &gt; <span class="number">10</span>) =&gt; <span class="number">10</span></span><br><span class="line">      <span class="keyword">case</span> <span class="type">Bar</span>(i) =&gt; i</span><br><span class="line">      <span class="keyword">case</span> <span class="type">Baz</span>(s) =&gt; s</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  handle(<span class="keyword">new</span> <span class="type">Bar</span>(<span class="number">42</span>))                             <span class="comment">//&gt; res0: Any = 10</span></span><br><span class="line">  handle(<span class="keyword">new</span> <span class="type">Bar</span>(<span class="number">3</span>))                              <span class="comment">//&gt; res0: Any = 3</span></span><br><span class="line">  handle(<span class="keyword">new</span> <span class="type">Baz</span>(<span class="string">"Luhrmann"</span>))                     <span class="comment">//&gt; res1: Any = Luhrmann</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>简洁,灵活.再来看一下java版本的:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">  <span class="keyword">abstract</span> &lt;T&gt; <span class="function">T <span class="title">match</span><span class="params">(Visitor&lt;T&gt; visitor)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">interface</span> <span class="title">Visitor</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">T <span class="title">caseManyBar</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">T <span class="title">caseBar</span><span class="params">(<span class="keyword">int</span> i)</span></span>;</span><br><span class="line">    <span class="function">T <span class="title">caseBaz</span><span class="params">(String s)</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Bar</span> <span class="keyword">extends</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> bar;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Bar</span><span class="params">(<span class="keyword">int</span> bar)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.bar = bar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    &lt;T&gt; <span class="function">T <span class="title">match</span><span class="params">(Visitor&lt;T&gt; visitor)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> bar &gt; <span class="number">10</span> ? visitor.caseManyBar() : visitor.caseBar(bar);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Baz</span> <span class="keyword">extends</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String baz;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Baz</span><span class="params">(String baz)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.baz = baz;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    &lt;T&gt; <span class="function">T <span class="title">match</span><span class="params">(Visitor&lt;T&gt; visitor)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> visitor.caseBaz(baz);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(Foo f)</span> </span>&#123;</span><br><span class="line">    System.out.println(f.match(<span class="keyword">new</span> Visitor&lt;String&gt;() &#123;</span><br><span class="line">      <span class="annotation">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">caseBar</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"I have "</span> + i + <span class="string">" bars"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="annotation">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">caseManyBar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"I have many bars"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="annotation">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">caseBaz</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"I have the "</span> + s + <span class="string">" baz"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    handle(<span class="keyword">new</span> Bar(<span class="number">42</span>));</span><br><span class="line">    handle(<span class="keyword">new</span> Bar(<span class="number">3</span>));</span><br><span class="line">    handle(<span class="keyword">new</span> Baz(<span class="string">"Luhrmann"</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>16vs58,很难说用多余的42行来模拟相同的功能是否值得.<br>访问者模式的好处是,让你以一种类型安全的方式来处理子类.<br>在你添加新的子类时,编译器会告诉你哪些代码需要修改.<br>当你下一次遇到ClassCastException时你应该考虑使用它.</p>
<p>原文:<br><a href="http://eng.wealthfront.com/2015/02/pattern-matching-in-java-with-visitor.html" target="_blank" rel="external">Pattern matching in Java with the Visitor pattern</a></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/10/13/java内存探险/" itemprop="url">
                java内存探险(待续)
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          發表於
          <time itemprop="dateCreated" datetime="2015-10-13T00:00:00+08:00" content="2015-10-13">
            2015-10-13
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分類於
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Programming/" itemprop="url" rel="index">
                  <span itemprop="name">Programming</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/10/13/java内存探险/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/10/13/java内存探险/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>之前写的b站直播订阅通知的程序内存占用始终不能满意,<br>想到java是跑在jvm上的,<br>是否jvm本身就需要占用那么多的内存呢,<br>决定打开jconsole来看一看.<br>java内存分为堆和非堆,来看定义:</p>
<blockquote>
<h5 id="Heap_memory">Heap memory</h5><p>The heap memory is the runtime data area from which the Java VM allocates memory for all class instances and arrays. The heap may be of a fixed or variable size. The garbage collector is an automatic memory management system that reclaims heap memory for objects.</p>
<ul>
<li><p>Eden Space: The pool from which memory is initially allocated for most objects.</p>
</li>
<li><p>Survivor Space: The pool containing objects that have survived the garbage collection of the Eden space.</p>
</li>
<li><p>Tenured Generation: The pool containing objects that have existed for some time in the survivor space.</p>
</li>
</ul>
<h5 id="Non-heap_memory">Non-heap memory</h5><p>Non-heap memory includes a method area shared among all threads and memory required for the internal processing or optimization for the Java VM. It stores per-class structures such as a runtime constant pool, field and method data, and the code for methods and constructors. The method area is logically part of the heap but, depending on the implementation, a Java VM may not garbage collect or compact it. Like the heap memory, the method area may be of a fixed or variable size. The memory for the method area does not need to be contiguous.</p>
<ul>
<li><p>Permanent Generation: The pool containing all the reflective data of the virtual machine itself, such as class and method objects. With Java VMs that use class data sharing, this generation is divided into read-only and read-write areas.</p>
</li>
<li><p>Code Cache: The HotSpot Java VM also includes a code cache, containing memory that is used for compilation and storage of native code.</p>
</li>
</ul>
</blockquote>
<p>我的程序的堆内存占用:<br><img src="https://ooo.0o0.ooo/2015/10/13/561cad5c33358.png" alt=""><br>这个程序每五分钟会去爬一次直播间的直播状态,<br>在这个点上堆内存占用升高,<br>GC之后又回落下来,<br>整体上在6.5M左右徘徊,<br>问题不大.<br>再来看非堆:<br><img src="https://ooo.0o0.ooo/2015/10/13/561cae38326d2.png" alt=""><br>整体30M左右,基本上不变化.</p>
<hr>
<p>实际上JAVA程序在启动时可以指定内存占用的大小,<br><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">-Xms128m -Xmx256m</span></span><br></pre></td></tr></table></figure></p>
<p>上面这行代码就指定了堆的初始化内存为128MB,最大为256MB.<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby"><span class="constant">XX</span><span class="symbol">:PermSize256m</span> <span class="constant">XX</span><span class="symbol">:MaxPermSize512m</span></span></span><br></pre></td></tr></table></figure></p>
<p>上面这行代码用来指定非堆内存的永久代(<strong>PermGen</strong>)大小.<br>然而我试过将MaxPermSize设为20m,<br>非堆内存占用并没有什么变化.</p>
<hr>
<p>手头上还有一个舰娘的辅助程序,从github上下载的,<br>来看一下它的内存占用.<br>堆内存:<br><img src="https://ooo.0o0.ooo/2015/10/13/561cb1413c8a5.png" alt=""><br>非堆:<br><img src="https://ooo.0o0.ooo/2015/10/13/561cb18c012a9.png" alt=""><br>非堆几乎是一样的.</p>
<p>这下可以安心了,自己的程序内存占用是正常的.<br>参考:<br><a href="https://docs.oracle.com/cd/E22289_01/html/821-1274/configuring-the-default-jvm-and-java-arguments.html" target="_blank" rel="external">Configuring JVM Options</a><br><a href="http://stackoverflow.com/questions/1493913/how-to-set-the-maximum-memory-usage-for-jvm" target="_blank" rel="external">How to set the maximum memory usage for JVM</a></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/10/09/博客启用https/" itemprop="url">
                博客启用https(支持hexo)
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          發表於
          <time itemprop="dateCreated" datetime="2015-10-09T00:00:00+08:00" content="2015-10-09">
            2015-10-09
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分類於
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/互联网/" itemprop="url" rel="index">
                  <span itemprop="name">互联网</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/10/09/博客启用https/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/10/09/博客启用https/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><ol>
<li><a href="https://www.cloudflare.com/" target="_blank" rel="external">CloudFlare</a>是目前唯一一家提供免费ssl的cdn,注册完设置好nameserver之后大约等一个多小时,<br>网站就可以使用https访问了.<br><a href="https://www.ssllabs.com" target="_blank" rel="external">ssllabs</a>的测试结果:<br><img src="https://ooo.0o0.ooo/2015/10/09/56179c7581b1d.jpg" alt="" title="result"><br>从图中可以看到,浏览器必须支持sni.</li>
<li><p>然后就是让用户的http请求跳转到https.<br>在 <code>layout/_scripts</code> 目录下加一个 script,然后在 <code>layout/_layout.swig</code> 中 include 进去.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript"></span><br><span class="line">    <span class="keyword">var</span> host = <span class="string">"yoursite.com"</span>;</span><br><span class="line">    <span class="keyword">if</span> ((host == <span class="built_in">window</span>.location.host) &amp;&amp; (<span class="built_in">window</span>.location.protocol != <span class="string">"https:"</span>))</span><br><span class="line">        <span class="built_in">window</span>.location.protocol = <span class="string">"https"</span>;</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>设置网站的url,让google等搜索引擎知道你正在使用ssl.<br>在<code>_config.yml</code>中增加:</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">url</span>: <span class="attribute">https</span>:<span class="comment">//www.yoursite.com   # with the https protocol</span></span><br><span class="line"><span class="attribute">enforce_ssl</span>: www.yoursite.com   # without any protocol</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>参考:<br><a href="https://sheharyar.me/blog/free-ssl-for-github-pages-with-custom-domains/" target="_blank" rel="external">Set Up SSL on Github Pages With Custom Domains for Free</a><br><a href="https://github.com/iissnan/hexo-theme-next/issues/123" target="_blank" rel="external">HTTPS下点击页面自动跳转HTTP</a></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/09/15/java8-mixin/" itemprop="url">
                java8-mixin
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          發表於
          <time itemprop="dateCreated" datetime="2015-09-15T00:00:00+08:00" content="2015-09-15">
            2015-09-15
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分類於
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Programming/" itemprop="url" rel="index">
                  <span itemprop="name">Programming</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/09/15/java8-mixin/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/09/15/java8-mixin/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>java8开始接口支持了默认方法,从此mixin也变为可能了.</p>
<p>先来看看mixin是什么:</p>
<blockquote>
<p>In object-oriented programming languages, a mixin is a class that contains a <strong><em>combination</em></strong> of methods from other classes. How such a combination is done depends on the language. If a combination contains all methods of combined classes, it is equivalent to <strong><em>multiple inheritance</em></strong>. Mixins are sometimes described as being “included” rather than “inherited”.</p>
<p>Mixins encourage code reuse and can be used to avoid the inheritance ambiguity that multiple inheritance can cause (the “<a href="https://en.wikipedia.org/wiki/Multiple_inheritance#The_diamond_problem" target="_blank" rel="external">diamond problem</a>“), or to work around lack of support for multiple inheritance in a language. A mixin can also be viewed as an <strong><em>interface with implemented methods</em></strong>.</p>
</blockquote>
<p>mixin混合了其他类的功能但是又不会引发多重继承的问题.</p>
<p>下面是一个简单的迭代器.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AbsIterator</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> T <span class="title">next</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>给上面的迭代器增加了foreach方法,接收一个consumer,<br>对每个元素执行相同的操作.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RichIterator</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">AbsIterator</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">default</span> <span class="keyword">void</span> <span class="title">foreach</span><span class="params">(Consumer&lt;? <span class="keyword">super</span> T&gt; consumer)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">while</span> (hasNext())</span><br><span class="line">			consumer.accept(next());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一个基于String的实现.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringIterator</span> <span class="keyword">implements</span> <span class="title">AbsIterator</span>&lt;<span class="title">Character</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String s;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">StringIterator</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.s = s;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> i &lt; s.length();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Character <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Character character = s.charAt(i);</span><br><span class="line">		i++;</span><br><span class="line">		<span class="keyword">return</span> character;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后是一个测试类.<br>测试用的迭代器即有StringIterator的实现,<br>又具有RichIterator的foreach方法.<br>在java8以前我们要怎么做这件事呢,<br>似乎是没法做,<br>由于接口没有默认方法,<br>我们必须在每个迭代器实现中重写foreach方法.<br>mixin增强了代码的重用能力.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringIteratorTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Iter iter = <span class="keyword">new</span> Iter(<span class="string">"test"</span>);</span><br><span class="line">		iter.foreach(System.out::println);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Iter</span> <span class="keyword">extends</span> <span class="title">StringIterator</span> <span class="keyword">implements</span> <span class="title">RichIterator</span>&lt;<span class="title">Character</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="title">Iter</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">super</span>(s);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考:<a href="http://www.scala-lang.org/old/node/117" target="_blank" rel="external">scala-mixin</a></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
 </div>

        

        
      </div>

      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="https://lh3.googleusercontent.com/-XLEofF80y2s/AAAAAAAAAAI/AAAAAAAAAYc/9Wu-onxRB7g/s120-c/photo.jpg" alt="winry" itemprop="image"/>
          <p class="site-author-name" itemprop="name">winry</p>
        </div>
        <p class="site-description motion-element" itemprop="description">acg&programming sharing</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">5</span>
              <span class="site-state-item-name">文章</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">2</span>
              <span class="site-state-item-name">分類</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">8</span>
              <span class="site-state-item-name">標籤</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="menu-item-icon icon-next-feed"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy; &nbsp; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">winry</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 強力驅動
</div>

<div class="theme-info">
  主題 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    
    

  

    <script type="text/javascript">
      var disqus_shortname = 'winry';
      var disqus_identifier = 'index.html';
      var disqus_title = '';
      var disqus_url = '';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
    </script>
  


  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.1"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.1"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.1" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.1"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  

  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }
    });
  </script>

  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
</body>
</html>
